var W=Object.defineProperty;var H=(v,s,l)=>s in v?W(v,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[s]=l;var g=(v,s,l)=>(H(v,typeof s!="symbol"?s+"":s,l),l);import{n as K,D as N,W as U,I as $,r as j}from"./vendor.84124ed7.js";const q=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function l(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerpolicy&&(c.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?c.credentials="include":a.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=l(a);fetch(a.href,c)}};q();class z{constructor(s="wss://demos.yjs.dev"){g(this,"self_id");g(this,"room_id");g(this,"doc");g(this,"websocketProvider");g(this,"toUpdate");g(this,"indexeddbProvider");this.self_id=K(),this.room_id=`digital-fingerprints-${window.location.host+window.location.pathname}`,this.doc=new N,this.websocketProvider=new U(s,this.room_id,this.doc),this.indexeddbProvider=new $("digital-fingerprints",this.doc),this.indexeddbProvider.whenSynced.then(()=>{console.log("loaded data from indexed db")}),this.toUpdate=!0,console.log(`connecting to ${this.room_id} with id ${this.self_id}`);function l(){return document.getElementById("fingerprint")}const i=l();var a=document.getElementById("radiusBlur"),c=document.getElementById("radTextBlur"),u=document.getElementById("radiusPoint"),k=document.getElementById("radTextPoint"),d=[],w=100,B=10,m=!1,n=i.getContext("2d");const f=this.doc.getArray("drawActions");let y=-1;n.globalCompositeOperation="color",n.lineWidth=w*2,n.shadowBlur=B;const p=j();n.strokeStyle=p,n.fillStyle=p,n.shadowColor=p;const T=document.getElementById("colorPicker");T.value=p;function D(e){m=!0,b(e)}function X(){m&&(m=!1,Y())}f.observe(async e=>{const t=f.toArray().slice(y+1);console.log("in stack ",y,f.toArray());for(const r of t){console.log("drawing from stack");var o=new Image;o.src=r,await o.decode(),n.clearRect(0,0,i.width,i.height),n.drawImage(o,0,0),y++}});function Y(){f.push([l().toDataURL()]),y++}async function C(){if(!f.length){n.clearRect(0,0,i.width,i.height);return}var e=new Image;e.src=f.get(f.length-1),f.delete(f.length-1),await e.decode(),n.clearRect(0,0,i.width,i.height),n.drawImage(e,0,0)}function b(e){if(m){const t=L(i),o=e.clientX-t.x,r=e.clientY-t.y;n.beginPath(),n.lineTo(o,r),n.stroke(),n.arc(o,r,w,0,Math.PI*2),n.fill(),n.moveTo(o,r),n.closePath()}}function A(e){for(var t=e.changedTouches,o=0;o<t.length;o++)P(t[o])&&(e.preventDefault(),n.beginPath(),d.push(x(t[o])),n.fill(),n.closePath())}function _(e){for(var t=e.changedTouches,o=L(i),r=0;r<t.length;r++)if(P(t[r])){e.preventDefault();var h=I(t[r].identifier);h>=0&&(n.lineTo(t[r].clientX-o.x,t[r].clientY-o.y),n.stroke(),n.beginPath(),n.arc(t[r].clientX-o.x,t[r].clientY-o.y,w,0,Math.PI*2),n.fill(),n.moveTo(d[h].clientX-o.x,d[h].clientY-o.y),n.closePath(),d.splice(h,1,x(t[r])))}}function E(e){for(var t=e.changedTouches,o=L(i),r=0;r<t.length;r++)if(P(t[r])){e.preventDefault();var h=I(t[r].identifier);h>=0&&(n.beginPath(),n.moveTo(d[h].clientX-o.x,d[h].clientY-o.y),n.lineTo(t[r].clientX-o.x,t[r].clientY-o.y),d.splice(r,1))}}function R(e){e.preventDefault();for(var t=e.changedTouches,o=0;o<t.length;o++)d.splice(o,1)}function x(e){return{identifier:e.identifier,clientX:e.clientX,clientY:e.clientY}}function I(e){for(var t=0;t<d.length;t++){var o=d[t].identifier;if(o==e)return t}return-1}function P(e){var t=0,o=0,r=0;if(i.offsetParent){do t+=i.offsetLeft,o+=i.offsetTop;while(e==i.offsetParent);r={x:t-document.body.scrollLeft,y:o-document.body.scrollTop}}return e.clientX-r.x>0&&e.clientX-r.x<parseFloat(i.width)&&e.clientY-r.y>0&&e.clientY-r.y<parseFloat(i.height)}function L(e){const t=e.getBoundingClientRect();return{x:t.left,y:t.top}}var S=function(e){n.shadowBlur=e},M=function(e){n.lineWidth=e*2};u==null||u.addEventListener("input",function(){k.innerHTML=u.value,M(this.value)}),a==null||a.addEventListener("input",function(){c.innerHTML=a.value,S(this.value)});var O=function(e){n.strokeStyle=e,n.fillStyle=e,n.shadowColor=e},F=function(e){var t=e.target;O(t.value)};T.addEventListener("change",F),i.addEventListener("mousedown",D),i.addEventListener("mouseup",X),i.addEventListener("mousemove",b),i.addEventListener("touchstart",A,!1),i.addEventListener("touchend",E,!1),i.addEventListener("touchcancel",R,!1),i.addEventListener("touchleave",E,!1),i.addEventListener("touchmove",_,!1),document.addEventListener("keydown",async e=>{(e.ctrlKey||e.metaKey)&&e.key==="z"&&(await C(),e.preventDefault())})}clearLocalHistory(){this.indexeddbProvider.clearData()}}new z;
